{% extends 'base.html' %}

{% block title %}Email Logs - RuweHolyGhostChurch{% endblock %}
{% block page_title %}Email Logs{% endblock %}

{% block content %}
<div class="content-section">
    <form method="get" class="search-filters">
        <input type="text" name="search" value="{{ search_query }}" placeholder="Search logs...">
        <select name="status">
            <option value="">All Statuses</option>
            {% for value, label in status_choices %}
            <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-secondary">Filter</button>
    </form>
    
    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Recipient Name</th>
                    <th>Email</th>
                    <th>Subject</th>
                    <th>Campaign</th>
                    <th>Status</th>
                    <th>Sent At</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>{{ log.recipient_name }}</td>
                    <td>{{ log.recipient_email }}</td>
                    <td>{{ log.subject|truncatewords:12 }}</td>
                    <td>{% if log.campaign %}<a href="{% url 'email_system:campaign_detail' log.campaign.id %}">{{ log.campaign.name }}</a>{% else %}Direct Email{% endif %}</td>
                    <td><span class="badge badge-{{ log.status }}">{{ log.get_status_display }}</span></td>
                    <td>{{ log.sent_at|date:"M d, Y H:i"|default:"Not sent" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center;">No email logs found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    {% if logs.has_other_pages %}
    <div class="pagination">
        {% if logs.has_previous %}
        <a href="?page={{ logs.previous_page_number }}&search={{ search_query }}&status={{ status_filter }}">Previous</a>
        {% endif %}
        
        <span>Page {{ logs.number }} of {{ logs.paginator.num_pages }}</span>
        
        {% if logs.has_next %}
        <a href="?page={{ logs.next_page_number }}&search={{ search_query }}&status={{ status_filter }}">Next</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
