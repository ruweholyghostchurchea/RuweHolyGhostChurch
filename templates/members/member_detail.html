
{% extends 'base.html' %}

{% block title %}{{ member.full_name }} - Member Details{% endblock %}

{% block page_title %}Member Details{% endblock %}

{% block content %}
<!-- Back Navigation -->
<div style="margin-bottom: 20px;">
    <a href="{% url 'members:index' %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left" style="margin-right: 8px;"></i>
        Back to Members List
    </a>
</div>

<!-- Member Profile Card -->
<div class="card">
    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
        <h5 class="card-title">
            <i class="fas fa-user" style="color: #dc2626; margin-right: 10px;"></i>
            {{ member.full_name }}
        </h5>
        <div>
            <span class="badge badge-{% if member.membership_status == 'Active' %}success{% elif member.membership_status == 'Inactive' %}warning{% else %}secondary{% endif %}">
                {{ member.membership_status }}
            </span>
            {% if member.is_staff %}
            <span class="badge badge-info">Staff</span>
            {% endif %}
            {% if member.is_ordained %}
            <span class="badge badge-purple">Ordained</span>
            {% endif %}
            {% if member.is_pwd %}
            <span class="badge badge-danger">PWD</span>
            {% endif %}
        </div>
    </div>

    <div style="padding: 20px;">
        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px;">
            <!-- Profile Photo -->
            <div style="text-align: center;">
                {% if member.display_photo %}
                <img src="{{ member.display_photo }}" alt="{{ member.full_name }}" 
                     style="width: 200px; height: 200px; object-fit: cover; border-radius: 10px; border: 3px solid #dc2626;">
                {% else %}
                <div style="width: 200px; height: 200px; background: #374151; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                    <i class="fas fa-user" style="font-size: 80px; color: #9ca3af;"></i>
                </div>
                {% endif %}
            </div>

            <!-- Member Details -->
            <div>
                <!-- Personal Information -->
                <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                    <i class="fas fa-user" style="margin-right: 8px;"></i>
                    Personal Information
                </h6>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div>
                        <strong style="color: #9ca3af;">Identifier:</strong>
                        <p style="color: #22c55e; margin: 0; font-weight: bold;">{{ member.identifier }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Username:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.username }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">User Group:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.user_group }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Gender:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.get_gender_display }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Date of Birth:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.date_of_birth }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Marital Status:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.get_marital_status_display }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Location:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.get_location_display }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Education Level:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.get_education_level_display }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Date Joined:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.date_joined_app }}</p>
                    </div>
                </div>

                <!-- Contact Information -->
                <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                    <i class="fas fa-phone" style="margin-right: 8px;"></i>
                    Contact Information
                </h6>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div>
                        <strong style="color: #9ca3af;">Phone Number:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.phone_number }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Email Address:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.email_address|default:"Not provided" }}</p>
                    </div>
                </div>

                <!-- Job Information -->
                <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                    <i class="fas fa-briefcase" style="margin-right: 8px;"></i>
                    Employment Information
                </h6>
                <div style="margin-bottom: 20px;">
                    <strong style="color: #9ca3af;">Job/Occupation/Income:</strong>
                    <p style="color: #ffffff; margin: 0;">{{ member.job_occupation_income }}</p>
                </div>
            </div>
        </div>

        <!-- Baptismal Information -->
        <div style="margin-top: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-water" style="margin-right: 8px;"></i>
                Baptismal Information
            </h6>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                <div>
                    <strong style="color: #9ca3af;">Baptismal Name:</strong>
                    <p style="color: #ffffff; margin: 0;">{{ member.baptismal_full_name }}</p>
                </div>
                <div>
                    <strong style="color: #9ca3af;">Date Baptized:</strong>
                    <p style="color: #ffffff; margin: 0;">{{ member.date_baptized }}</p>
                </div>
                <div>
                    <strong style="color: #9ca3af;">Date Joined Religion:</strong>
                    <p style="color: #ffffff; margin: 0;">{{ member.date_joined_religion }}</p>
                </div>
            </div>
        </div>

        <!-- Church Structure -->
        <div style="margin-top: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-church" style="margin-right: 8px;"></i>
                Church Structure
            </h6>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <!-- Home Church -->
                <div>
                    <h6 style="color: #22c55e; margin-bottom: 10px;">Home Church</h6>
                    <div>
                        <strong style="color: #9ca3af;">Diocese:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.user_home_diocese.name }} ({{ member.user_home_diocese.country }})</p>
                        <small style="color: #9ca3af;">ID: {{ member.user_home_diocese.identifier }}</small>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Pastorate:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.user_home_pastorate.name }}</p>
                        <small style="color: #9ca3af;">ID: {{ member.user_home_pastorate.identifier }}</small>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Church:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.user_home_church.name }}</p>
                        <small style="color: #9ca3af;">ID: {{ member.user_home_church.identifier }}</small>
                    </div>
                </div>

                <!-- Town Church -->
                <div>
                    <h6 style="color: #3b82f6; margin-bottom: 10px;">Town Church</h6>
                    {% if member.user_town_church %}
                    <div>
                        <strong style="color: #9ca3af;">Diocese:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.user_town_diocese.name }} ({{ member.user_town_diocese.country }})</p>
                        <small style="color: #9ca3af;">ID: {{ member.user_town_diocese.identifier }}</small>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Pastorate:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.user_town_pastorate.name }}</p>
                        <small style="color: #9ca3af;">ID: {{ member.user_town_pastorate.identifier }}</small>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Church:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.user_town_church.name }}</p>
                        <small style="color: #9ca3af;">ID: {{ member.user_town_church.identifier }}</small>
                    </div>
                    {% else %}
                    <p style="color: #9ca3af; font-style: italic;">Not assigned to a town church</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- PWD Information -->
        {% if member.is_pwd %}
        <div style="margin-top: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-wheelchair" style="margin-right: 8px;"></i>
                Person with Disability (PWD) Information
            </h6>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                <div>
                    <strong style="color: #9ca3af;">Type of Disability:</strong>
                    <p style="color: #ffffff; margin: 0;">{{ member.get_pwd_type_display }}</p>
                </div>
                {% if member.pwd_other_description %}
                <div>
                    <strong style="color: #9ca3af;">Description:</strong>
                    <p style="color: #ffffff; margin: 0;">{{ member.pwd_other_description }}</p>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Family Details -->
        <div style="margin-top: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-users" style="margin-right: 8px;"></i>
                Family Details
            </h6>
            
            {% if member.fathers or member.mothers or member.spouse.name or member.guardians or member.brothers or member.sisters or member.uncles or member.aunts or member.friends %}
                <!-- Fathers -->
                {% if member.fathers %}
                <div style="margin-bottom: 20px;">
                    <strong style="color: #22c55e; display: block; margin-bottom: 10px;">Fathers:</strong>
                    {% for father in member.fathers %}
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <p style="color: #ffffff; margin: 0; font-weight: bold;">{{ father.name }}</p>
                                <small style="color: #9ca3af;">{{ father.relationship_type|title }} • {{ father.phone }}</small>
                                {% if father.is_member and father.member_identifier %}
                                <small style="color: #22c55e; display: block;">Member: {{ father.member_identifier }}</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Mothers -->
                {% if member.mothers %}
                <div style="margin-bottom: 20px;">
                    <strong style="color: #22c55e; display: block; margin-bottom: 10px;">Mothers:</strong>
                    {% for mother in member.mothers %}
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <p style="color: #ffffff; margin: 0; font-weight: bold;">{{ mother.name }}</p>
                                <small style="color: #9ca3af;">{{ mother.relationship_type|title }} • {{ mother.phone }}</small>
                                {% if mother.is_member and mother.member_identifier %}
                                <small style="color: #22c55e; display: block;">Member: {{ mother.member_identifier }}</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Spouse -->
                {% if member.spouse.name %}
                <div style="margin-bottom: 20px;">
                    <strong style="color: #22c55e; display: block; margin-bottom: 10px;">Spouse:</strong>
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px;">
                        <p style="color: #ffffff; margin: 0; font-weight: bold;">{{ member.spouse.name }}</p>
                        <small style="color: #9ca3af;">{{ member.spouse.phone }}</small>
                        {% if member.spouse.is_member and member.spouse.member_identifier %}
                        <small style="color: #22c55e; display: block;">Member: {{ member.spouse.member_identifier }}</small>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Guardians -->
                {% if member.guardians %}
                <div style="margin-bottom: 20px;">
                    <strong style="color: #22c55e; display: block; margin-bottom: 10px;">Guardians:</strong>
                    {% for guardian in member.guardians %}
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; margin-bottom: 8px;">
                        <p style="color: #ffffff; margin: 0; font-weight: bold;">{{ guardian.name }}</p>
                        <small style="color: #9ca3af;">{{ guardian.phone }}</small>
                        {% if guardian.is_member and guardian.member_identifier %}
                        <small style="color: #22c55e; display: block;">Member: {{ guardian.member_identifier }}</small>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Brothers, Sisters, Uncles, Aunts, Friends -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    {% if member.brothers %}
                    <div>
                        <strong style="color: #22c55e; display: block; margin-bottom: 10px;">Brothers:</strong>
                        {% for brother in member.brothers %}
                        <div style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px; margin-bottom: 6px;">
                            <p style="color: #ffffff; margin: 0; font-size: 0.9em;">{{ brother.name }}</p>
                            <small style="color: #9ca3af; font-size: 0.8em;">{{ brother.phone }}</small>
                            {% if brother.is_member and brother.member_identifier %}
                            <small style="color: #22c55e; display: block; font-size: 0.8em;">Member: {{ brother.member_identifier }}</small>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if member.sisters %}
                    <div>
                        <strong style="color: #22c55e; display: block; margin-bottom: 10px;">Sisters:</strong>
                        {% for sister in member.sisters %}
                        <div style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px; margin-bottom: 6px;">
                            <p style="color: #ffffff; margin: 0; font-size: 0.9em;">{{ sister.name }}</p>
                            <small style="color: #9ca3af; font-size: 0.8em;">{{ sister.phone }}</small>
                            {% if sister.is_member and sister.member_identifier %}
                            <small style="color: #22c55e; display: block; font-size: 0.8em;">Member: {{ sister.member_identifier }}</small>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if member.uncles %}
                    <div>
                        <strong style="color: #22c55e; display: block; margin-bottom: 10px;">Uncles:</strong>
                        {% for uncle in member.uncles %}
                        <div style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px; margin-bottom: 6px;">
                            <p style="color: #ffffff; margin: 0; font-size: 0.9em;">{{ uncle.name }}</p>
                            <small style="color: #9ca3af; font-size: 0.8em;">{{ uncle.phone }}</small>
                            {% if uncle.is_member and uncle.member_identifier %}
                            <small style="color: #22c55e; display: block; font-size: 0.8em;">Member: {{ uncle.member_identifier }}</small>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if member.aunts %}
                    <div>
                        <strong style="color: #22c55e; display: block; margin-bottom: 10px;">Aunts:</strong>
                        {% for aunt in member.aunts %}
                        <div style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px; margin-bottom: 6px;">
                            <p style="color: #ffffff; margin: 0; font-size: 0.9em;">{{ aunt.name }}</p>
                            <small style="color: #9ca3af; font-size: 0.8em;">{{ aunt.phone }}</small>
                            {% if aunt.is_member and aunt.member_identifier %}
                            <small style="color: #22c55e; display: block; font-size: 0.8em;">Member: {{ aunt.member_identifier }}</small>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if member.friends %}
                    <div>
                        <strong style="color: #22c55e; display: block; margin-bottom: 10px;">Friends:</strong>
                        {% for friend in member.friends %}
                        <div style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px; margin-bottom: 6px;">
                            <p style="color: #ffffff; margin: 0; font-size: 0.9em;">{{ friend.name }}</p>
                            <small style="color: #9ca3af; font-size: 0.8em;">{{ friend.phone }}</small>
                            {% if friend.is_member and friend.member_identifier %}
                            <small style="color: #22c55e; display: block; font-size: 0.8em;">Member: {{ friend.member_identifier }}</small>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            {% else %}
            <p style="color: #9ca3af; font-style: italic;">No family details provided</p>
            {% endif %}
        </div>

        <!-- Emergency Contacts -->
        {% if member.emergency_contact_1_name or member.emergency_contact_2_name %}
        <div style="margin-top: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-phone-alt" style="margin-right: 8px;"></i>
                Emergency Contacts
            </h6>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                {% if member.emergency_contact_1_name %}
                <div>
                    <h6 style="color: #f59e0b; margin-bottom: 10px;">Contact 1</h6>
                    <div>
                        <strong style="color: #9ca3af;">Name:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.emergency_contact_1_name }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Relationship:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.emergency_contact_1_relationship }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Phone:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.emergency_contact_1_phone }}</p>
                    </div>
                    {% if member.emergency_contact_1_email %}
                    <div>
                        <strong style="color: #9ca3af;">Email:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.emergency_contact_1_email }}</p>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                {% if member.emergency_contact_2_name %}
                <div>
                    <h6 style="color: #f59e0b; margin-bottom: 10px;">Contact 2</h6>
                    <div>
                        <strong style="color: #9ca3af;">Name:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.emergency_contact_2_name }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Relationship:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.emergency_contact_2_relationship }}</p>
                    </div>
                    <div>
                        <strong style="color: #9ca3af;">Phone:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.emergency_contact_2_phone }}</p>
                    </div>
                    {% if member.emergency_contact_2_email %}
                    <div>
                        <strong style="color: #9ca3af;">Email:</strong>
                        <p style="color: #ffffff; margin: 0;">{{ member.emergency_contact_2_email }}</p>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Custom Fields -->
        {% if member.custom_fields %}
        <div style="margin-top: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-cogs" style="margin-right: 8px;"></i>
                Custom Information
            </h6>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                {% for key, value in member.custom_fields.items %}
                <div>
                    <strong style="color: #9ca3af;">{{ key }}:</strong>
                    <p style="color: #ffffff; margin: 0;">{{ value }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Member Documents -->
        {% if member.documents.all %}
        <div style="margin-top: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-file-alt" style="margin-right: 8px;"></i>
                Member Documents
            </h6>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                {% for doc in member.documents.all %}
                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; border-left: 4px solid #dc2626;">
                    <h6 style="color: #ffffff; margin-bottom: 8px;">{{ doc.title }}</h6>
                    <p style="color: #9ca3af; margin: 0; font-size: 0.9em;">{{ doc.document_type }}</p>
                    {% if doc.description %}
                    <p style="color: #9ca3af; margin: 8px 0 0 0; font-size: 0.85em;">{{ doc.description }}</p>
                    {% endif %}
                    {% if doc.document_file %}
                    <a href="{{ doc.document_file.url }}" target="_blank" 
                       style="color: #3b82f6; text-decoration: none; font-size: 0.9em; display: inline-block; margin-top: 8px;">
                        <i class="fas fa-download" style="margin-right: 5px;"></i>
                        Download Document
                    </a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
