{% extends 'base.html' %}

{% block title %}Add Member - RuweHolyGhostChurch{% endblock %}

{% block page_title %}Add New Member{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h5 class="card-title">
            <i class="fas fa-user-plus" style="color: #dc2626; margin-right: 10px;"></i>
            Member Registration Form
        </h5>
    </div>

    <form method="POST" style="margin-top: 20px;" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Personal Information Section -->
        <div style="margin-bottom: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-user" style="margin-right: 8px;"></i>
                Personal Information
            </h6>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">First Name *</label>
                    <input type="text" name="first_name" required placeholder="e.g., Lawi"
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Last Name *</label>
                    <input type="text" name="last_name" required placeholder="e.g., Obonyo"
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Username *</label>
                    <input type="text" name="username" required placeholder="e.g., lawi_obonyo"
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Date of Birth *</label>
                    <input type="date" name="date_of_birth" id="date_of_birth" required onchange="calculateUserGroup()"
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">User Group (Auto-calculated) *</label>
                    <input type="text" id="user_group_display" readonly placeholder="Will be calculated from date of birth"
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #2d3748; color: #ffffff; border-radius: 4px;">
                    <input type="hidden" name="user_group" id="user_group" required>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Gender *</label>
                    <select name="gender" required
                            style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="">Select Gender</option>
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                    </select>
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Marital Status *</label>
                    <select name="marital_status" required
                            style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="">Select Marital Status</option>
                        <option value="single">Single</option>
                        <option value="married">Married</option>
                        <option value="divorced">Divorced</option>
                        <option value="widowed">Widowed</option>
                        <option value="separated">Separated</option>
                    </select>
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Location *</label>
                    <div style="position: relative;">
                        <input type="text" name="location" id="location-input" required placeholder="Start typing location (e.g., Nairobi, Kenya)"
                               style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;"
                               autocomplete="off">
                        <div id="location-suggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; max-height: 200px; overflow-y: auto; background: #1f2937; border: 1px solid #374151; border-top: none; border-radius: 0 0 4px 4px; z-index: 1000;">
                        </div>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Education Level *</label>
                    <select name="education_level" required
                            style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="">Select Education Level</option>
                        <option value="primary">Primary Education</option>
                        <option value="secondary">Secondary Education</option>
                        <option value="certificate">Certificate</option>
                        <option value="diploma">Diploma</option>
                        <option value="bachelor">Bachelor's Degree</option>
                        <option value="master">Master's Degree</option>
                        <option value="phd">PhD</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>

            <!-- Member Roles Section -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label style="color: #ffffff; margin-bottom: 8px; display: block;">Member Roles *</label>
                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <div class="form-check">
                            <input type="checkbox" name="member_roles" value="regular_member" id="role_regular" class="form-check-input" checked disabled>
                            <label for="role_regular" class="form-check-label" style="color: #ffffff;">Regular Member (Default)</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="member_roles" value="singer" id="role_singer" class="form-check-input">
                            <label for="role_singer" class="form-check-label" style="color: #ffffff;">Singer</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="member_roles" value="drum_percussionist" id="role_drum" class="form-check-input">
                            <label for="role_drum" class="form-check-label" style="color: #ffffff;">Drum Percussionist</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="member_roles" value="shaker_percussionist" id="role_shaker" class="form-check-input">
                            <label for="role_shaker" class="form-check-label" style="color: #ffffff;">Shaker Percussionist</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="member_roles" value="synod_representative" id="role_synod" class="form-check-input">
                            <label for="role_synod" class="form-check-label" style="color: #ffffff;">Synod Representative</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="member_roles" value="clergy" id="role_clergy" class="form-check-input" onchange="toggleClergyRoles()">
                            <label for="role_clergy" class="form-check-label" style="color: #ffffff;">Clergy</label>
                        </div>
                    </div>
                    <!-- Hidden input to ensure regular_member is always submitted -->
                    <input type="hidden" name="member_roles" value="regular_member">
                </div>
            </div>

            <!-- Church/Dean Clergy Roles Section -->
            <div id="church_clergy_section" class="form-group" style="margin-bottom: 20px; display: none;">
                <label style="color: #ffffff; margin-bottom: 8px; display: block;">Church/Dean Clergy Roles</label>
                <div style="background: rgba(220, 38, 38, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #dc2626;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        {% for role_code, role_label in church_clergy_roles %}
                        <div class="form-check">
                            <input type="checkbox" name="church_clergy_roles" value="{{ role_code }}" id="church_clergy_{{ role_code }}" class="form-check-input" onchange="enforceSingleChurchClergy(this)">
                            <label for="church_clergy_{{ role_code }}" class="form-check-label" style="color: #ffffff;">{{ role_label }}</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Special Clergy Roles Section -->
            <div id="special_clergy_section" class="form-group" style="margin-bottom: 20px; display: none;">
                <label style="color: #ffffff; margin-bottom: 8px; display: block;">Special Clergy Roles</label>
                <div style="background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 8px; border-left: 3px solid #ffd700;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        {% for role_code, role_label in special_clergy_roles %}
                        <div class="form-check">
                            <input type="checkbox" name="special_clergy_roles" value="{{ role_code }}" id="special_clergy_{{ role_code }}" class="form-check-input" onchange="enforceSingleSpecialClergy(this)">
                            <label for="special_clergy_{{ role_code }}" class="form-check-label" style="color: #ffffff;">{{ role_label }}</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Information Section -->
        <div style="margin-bottom: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-phone" style="margin-right: 8px;"></i>
                Contact Information
            </h6>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Phone Number *</label>
                    <input type="tel" name="phone_number" required placeholder="e.g., +254708581688"
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Email Address *</label>
                    <input type="email" name="email_address" required placeholder="e.g., lawifirst@gmail.com"
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
            </div>

            <!-- Membership Status -->
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 15px; margin-bottom: 15px;">
                <div class="col-md-4">
                    <label for="membership_status" class="form-label" style="color: #ffffff; margin-bottom: 5px; display: block;">Membership Status <span class="text-danger">*</span></label>
                    <select class="form-select" id="membership_status" name="membership_status" required
                        style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        {% for value, display in membership_statuses %}
                        <option value="{{ value }}" {% if value == 'Active' %}selected{% endif %}>{{ display }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="is_staff" class="form-label" style="color: #ffffff; margin-bottom: 5px; display: block;">Staff Status <span class="text-danger">*</span></label>
                    <select class="form-select" id="is_staff" name="is_staff" required
                        style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="No" selected>No</option>
                        <option value="Yes">Yes</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="is_ordained" class="form-label" style="color: #ffffff; margin-bottom: 5px; display: block;">Hand Ordination Status <span class="text-danger">*</span></label>
                    <select class="form-select" id="is_ordained" name="is_ordained" required
                        style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="No" selected>No</option>
                        <option value="Yes">Yes</option>
                    </select>
                </div>
            </div>

            <!-- Person with Disability -->
            <div class="row" style="margin-top: 15px;">
                <div class="col-md-4">
                    <label for="is_pwd" class="form-label">Person with Disability (PWD) <span class="text-danger">*</span></label>
                    <select class="form-select" id="is_pwd" name="is_pwd" onchange="togglePwdFields()" required
                        style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="No" selected>No</option>
                        <option value="Yes">Yes</option>
                    </select>
                </div>
                <div class="col-md-4" id="pwd_type_field" style="display: none;">
                    <label for="pwd_type" class="form-label">Type of Disability</label>
                    <select class="form-select" id="pwd_type" name="pwd_type" style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="">Select type...</option>
                        {% for value, display in pwd_types %}
                        <option value="{{ value }}">{{ display }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4" id="pwd_other_field" style="display: none;">
                    <label for="pwd_other_description" class="form-label">Other Disability Description</label>
                    <textarea class="form-control" id="pwd_other_description" name="pwd_other_description" rows="2" placeholder="Please specify if comfortable..."></textarea>
                </div>
            </div>
        </div>

        <!-- Family Details -->
        <div class="form-section" style="margin-bottom: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-users" style="margin-right: 10px; color: #dc2626;"></i>
                Family Details (Optional)
            </h6>
            <p style="color: #6b7280; font-size: 14px; margin-bottom: 20px;">Provide details for family members. You can link them to Ruwe Holy Ghost Church if they are members.</p>

            <!-- Fathers -->
            <div class="mb-3">
                <label style="color: #ffffff; margin-bottom: 10px; display: block; font-weight: bold;">
                    Father (Max 3: Biological, Baptismal, Hand Ordination)
                    <button type="button" onclick="addFather()" class="btn btn-success btn-sm ml-2" style="font-size: 0.8rem; padding: 4px 8px;">
                        <i class="fas fa-plus"></i> Add Father
                    </button>
                </label>
                <div id="fathers-container">
                    <!-- Initial Father field -->
                    <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div class="row">
                            <div class="col-md-3">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Type</label>
                                <select name="father_type[]" class="form-control" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                    <option value="biological">Biological</option>
                                    <option value="baptismal">Baptismal</option>
                                    <option value="hand_ordination">Hand Ordination</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                                <input type="text" name="father_name[]" class="form-control" placeholder="e.g., John Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                            </div>
                            <div class="col-md-2">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                                <input type="tel" name="father_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                            </div>
                            <div class="col-md-2">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                                <select name="father_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                    <option value="no">No</option>
                                    <option value="yes">Yes</option>
                                </select>
                            </div>
                            <div class="col-md-1 identifier-field" style="display: none;">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                                <input type="text" name="father_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                            </div>
                            <div class="col-md-1">
                                <label style="color: transparent; font-size: 0.9rem;">.</label>
                                <button type="button" onclick="this.closest('.family-member-row').remove(); fatherCount--;" class="btn btn-danger btn-sm" style="width: 100%;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mothers -->
            <div class="mb-3">
                <label style="color: #ffffff; margin-bottom: 10px; display: block; font-weight: bold;">
                    Mother (Max 3: Biological, Baptismal, Hand Ordination)
                    <button type="button" onclick="addMother()" class="btn btn-success btn-sm ml-2" style="font-size: 0.8rem; padding: 4px 8px;">
                        <i class="fas fa-plus"></i> Add Mother
                    </button>
                </label>
                <div id="mothers-container">
                    <!-- Initial Mother field -->
                    <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div class="row">
                            <div class="col-md-3">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Type</label>
                                <select name="mother_type[]" class="form-control" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                    <option value="biological">Biological</option>
                                    <option value="baptismal">Baptismal</option>
                                    <option value="hand_ordination">Hand Ordination</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                                <input type="text" name="mother_name[]" class="form-control" placeholder="e.g., Jane Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                            </div>
                            <div class="col-md-2">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                                <input type="tel" name="mother_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                            </div>
                            <div class="col-md-2">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                                <select name="mother_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                    <option value="no">No</option>
                                    <option value="yes">Yes</option>
                                </select>
                            </div>
                            <div class="col-md-1 identifier-field" style="display: none;">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                                <input type="text" name="mother_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                            </div>
                            <div class="col-md-1">
                                <label style="color: transparent; font-size: 0.9rem;">.</label>
                                <button type="button" onclick="this.closest('.family-member-row').remove(); motherCount--;" class="btn btn-danger btn-sm" style="width: 100%;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Spouse -->
            <div class="mb-3">
                <label style="color: #ffffff; margin-bottom: 10px; display: block; font-weight: bold;">
                    Spouse (Husband/Wife - Max 1)
                    <button type="button" onclick="addSpouse()" class="btn btn-success btn-sm ml-2" style="font-size: 0.8rem; padding: 4px 8px;">
                        <i class="fas fa-plus"></i> Add Spouse
                    </button>
                </label>
                <div id="spouses-container">
                    <!-- Initial Spouse field -->
                    <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div class="row">
                            <div class="col-md-4">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                                <input type="text" name="spouse_name[]" class="form-control" placeholder="e.g., Jane Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                            </div>
                            <div class="col-md-3">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                                <input type="tel" name="spouse_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                            </div>
                            <div class="col-md-2">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                                <select name="spouse_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                    <option value="no">No</option>
                                    <option value="yes">Yes</option>
                                </select>
                            </div>
                            <div class="col-md-2 identifier-field" style="display: none;">
                                <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                                <input type="text" name="spouse_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                            </div>
                            <div class="col-md-1">
                                <label style="color: transparent; font-size: 0.9rem;">.</label>
                                <button type="button" onclick="this.closest('.family-member-row').remove();" class="btn btn-danger btn-sm" style="width: 100%;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guardian -->
            <div class="mb-3">
                <label style="color: #ffffff; margin-bottom: 10px; display: block; font-weight: bold;">
                    Guardian (Max: 1 or more)
                    <button type="button" onclick="addGuardian()" class="btn btn-success btn-sm ml-2" style="font-size: 0.8rem; padding: 4px 8px;">
                        <i class="fas fa-plus"></i> Add Guardian
                    </button>
                </label>
                <div id="guardians-container"></div>
            </div>

            <!-- Brother -->
            <div class="mb-3">
                <label style="color: #ffffff; margin-bottom: 10px; display: block; font-weight: bold;">
                    Brother (Max: 1 or more)
                    <button type="button" onclick="addBrother()" class="btn btn-success btn-sm ml-2" style="font-size: 0.8rem; padding: 4px 8px;">
                        <i class="fas fa-plus"></i> Add Brother
                    </button>
                </label>
                <div id="brothers-container"></div>
            </div>

            <!-- Sister -->
            <div class="mb-3">
                <label style="color: #ffffff; margin-bottom: 10px; display: block; font-weight: bold;">
                    Sister (Max: 1 or more)
                    <button type="button" onclick="addSister()" class="btn btn-success btn-sm ml-2" style="font-size: 0.8rem; padding: 4px 8px;">
                        <i class="fas fa-plus"></i> Add Sister
                    </button>
                </label>
                <div id="sisters-container"></div>
            </div>

            <!-- Uncle -->
            <div class="mb-3">
                <label style="color: #ffffff; margin-bottom: 10px; display: block; font-weight: bold;">
                    Uncle (Max: 1 or more)
                    <button type="button" onclick="addUncle()" class="btn btn-success btn-sm ml-2" style="font-size: 0.8rem; padding: 4px 8px;">
                        <i class="fas fa-plus"></i> Add Uncle
                    </button>
                </label>
                <div id="uncles-container"></div>
            </div>

            <!-- Aunt -->
            <div class="mb-3">
                <label style="color: #ffffff; margin-bottom: 10px; display: block; font-weight: bold;">
                    Aunt (Max: 1 or more)
                    <button type="button" onclick="addAunt()" class="btn btn-success btn-sm ml-2" style="font-size: 0.8rem; padding: 4px 8px;">
                        <i class="fas fa-plus"></i> Add Aunt
                    </button>
                </label>
                <div id="aunts-container"></div>
            </div>

            <!-- Friend -->
            <div class="mb-3">
                <label style="color: #ffffff; margin-bottom: 10px; display: block; font-weight: bold;">
                    Friend (Max: 1 or more)
                    <button type="button" onclick="addFriend()" class="btn btn-success btn-sm ml-2" style="font-size: 0.8rem; padding: 4px 8px;">
                        <i class="fas fa-plus"></i> Add Friend
                    </button>
                </label>
                <div id="friends-container"></div>
            </div>
        </div>

        <!-- Emergency Contact Information Section -->
        <div style="margin-bottom: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                Emergency Contact Information
            </h6>

            <div style="margin-bottom: 20px;">
                <h7 style="color: #f3f4f6; margin-bottom: 10px; display: block; font-weight: bold;">Emergency Contact 1</h7>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="color: #ffffff; margin-bottom: 5px; display: block;">Name</label>
                        <input type="text" name="emergency_contact_1_name" placeholder="e.g., Alfayo Odongo Mango"
                               style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="color: #ffffff; margin-bottom: 5px; display: block;">Relationship</label>
                        <input type="text" name="emergency_contact_1_relationship" placeholder="e.g., Parent, Spouse, Sibling"
                               style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label style="color: #ffffff; margin-bottom: 5px; display: block;">Phone</label>
                        <input type="tel" name="emergency_contact_1_phone" placeholder="e.g., +254712345678"
                               style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="color: #ffffff; margin-bottom: 5px; display: block;">Email</label>
                        <input type="email" name="emergency_contact_1_email" placeholder="e.g., alfayomango@gmail.com"
                               style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                    </div>
                </div>
            </div>

            <div>
                <h7 style="color: #f3f4f6; margin-bottom: 10px; display: block; font-weight: bold;">Emergency Contact 2 (Optional)</h7>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="color: #ffffff; margin-bottom: 5px; display: block;">Name</label>
                        <input type="text" name="emergency_contact_2_name"
                               style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="color: #ffffff; margin-bottom: 5px; display: block;">Relationship</label>
                        <input type="text" name="emergency_contact_2_relationship" placeholder="e.g., Parent, Spouse, Sibling"
                               style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label style="color: #ffffff; margin-bottom: 5px; display: block;">Phone</label>
                        <input type="tel" name="emergency_contact_2_phone"
                               style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="color: #ffffff; margin-bottom: 5px; display: block;">Email</label>
                        <input type="email" name="emergency_contact_2_email"
                               style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Photo Management Section -->
        <div style="margin-bottom: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-image" style="margin-right: 8px;"></i>
                Profile Photo
            </h6>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Upload Photo</label>
                    <input type="file" name="profile_photo" accept="image/*"
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Or provide Image URL</label>
                    <input type="url" name="profile_photo_url" placeholder="e.g., https://example.com/image.jpg"
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
            </div>
        </div>

        <!-- Job/Occupation Information Section -->
        <div style="margin-bottom: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-briefcase" style="margin-right: 8px;"></i>
                Job & Occupation Information
            </h6>

            <div class="form-group" style="margin-bottom: 20px;">
                <label style="color: #ffffff; margin-bottom: 8px; display: block;">Select Job/Occupation Roles (Max 5 selections allowed)</label>
                <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; max-height: 400px; overflow-y: auto;">
                    {% for category_code, category_label in job_categories %}
                    <div style="margin-bottom: 20px;">
                        <h6 style="color: #22c55e; margin-bottom: 10px; font-weight: bold;">{{ category_label }}</h6>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 8px; margin-left: 15px;">
                            {% for job_code, job_label in job_choices %}
                                {% if category_code == "agriculture_agribusiness" and job_code in "smallholder_farmer,agronomist_extension_officer,farm_manager,livestock_farmer,agribusiness_entrepreneur,agro_inputs_salesperson,agricultural_technician_vet_assistant,produce_trader_market_agent,food_processing_operator,irrigation_technician" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "healthcare_medical" and job_code in "nurse_registered,clinical_officer_medical_officer,community_health_volunteer_chw,pharmacist_pharmaceutical_technologist,lab_technician_radiographer,physiotherapist_occupational_therapist,medical_records_officer_health_administrator,health_educator_public_health_officer,dental_therapist_dental_assistant,xray_imaging_technician,nutritionist_dietitian,psychologist_mental_performance_coach,orthopaedic_technologist" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "education_training" and job_code in "primary_school_teacher,secondary_school_teacher,university_lecturer_tutor,early_childhood_educator,pe_teacher_sports_coordinator,private_tutor,curriculum_developer_instructional_designer,training_coordinator_corporate_trainer,librarian_learning_resources_officer,education_administrator_headteacher" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "finance_banking_insurance" and job_code in "bank_teller_customer_service_rep,accountant_bookkeeper,credit_analyst_loan_officer,financial_analyst_investment_officer,microfinance_officer,insurance_agent_underwriter,tax_consultant_compliance_officer,treasury_cash_management_officer,auditor" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "ict" and job_code in "software_developer,data_analyst_business_intelligence,network_engineer_system_administrator,it_support_helpdesk_technician,ux_ui_designer_product_designer,devops_engineer_cloud_engineer,cybersecurity_analyst_soc_analyst,qa_tester_automation_tester,ai_ml_engineer" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "creative_media_digital" and job_code in "graphic_designer,content_writer_copywriter_blogger,social_media_manager_digital_marketer,videographer_video_editor,photographer,animator_motion_graphics_artist,radio_presenter_podcaster,journalist_news_reporter,pr_communications_officer" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "sales_retail_customer_service" and job_code in "retail_shop_attendant_cashier,sales_marketing_representative,store_manager_merchandiser,ecommerce_operator,customer_service_agent_call_centre,market_vendor_hawker,wholesale_trader_distributor,buying_clerk_procurement_assistant" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "hospitality_tourism_events" and job_code in "hotel_receptionist_front_desk,housekeeper_cleaner,chef_cook_sous_chef,restaurant_waiter_barista,tour_guide_travel_agent,event_planner_coordinator_manager,bartender_mixologist,lodge_manager_operations_manager" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "construction_infrastructure" and job_code in "civil_engineer_site_engineer,quantity_surveyor,architect_drafter,project_manager_construction,mason_bricklayer,carpenter_joiner,plumber_pipefitter,electrician_wiring_technician,heavy_equipment_operator" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "manufacturing_production" and job_code in "factory_machine_operator,production_supervisor_line_manager,quality_control_qa_inspector,textile_garment_worker_tailor,food_processing_technician,packaging_operator,maintenance_technician_millwright,plant_manager_production_planner" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "transportation_logistics" and job_code in "matatu_bus_driver,boda_boda_rider,ride_hailing_driver,truck_driver_long_haul,logistics_coordinator_freight_forwarder,warehouse_supervisor_storekeeper,courier_delivery_rider,fleet_manager,customs_clearing_agent" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "trades_skilled_labour" and job_code in "metal_fabricator_welder,motorcycle_automotive_mechanic,electrician_domestic_industrial,plumber_tiler_painter,tailor_seamstress,carpenter_furniture_maker,stone_mason_bricklayer,glass_glazing_technician" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "legal_compliance_governance" and job_code in "lawyer_advocate,paralegal_legal_assistant,compliance_officer_aml_analyst,court_clerk_magistrate_support,policy_analyst_legislative_assistant,notary_conveyancing_clerk" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "public_sector_civil_service_ngos" and job_code in "government_administrative_officer,county_government_officer,social_worker_community_development,program_officer_project_manager_ngo,monitoring_evaluation_officer,research_officer_policy_researcher,public_relations_communications_specialist,recruitment_officer_talent_scout" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "real_estate_property" and job_code in "real_estate_agent_broker,property_manager_estate_manager,valuer_surveyor,facilities_manager,construction_estimator,land_adjudication_registrar_assistant" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "energy_utilities_environment" and job_code in "renewable_energy_technician,electrical_engineer_power_systems,water_sanitation_engineer_technician,environmental_conservation_officer,waste_management_supervisor,gis_remote_sensing_specialist" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "agriculture_value_chain_agritech" and job_code in "food_processing_entrepreneur,cold_chain_logistics_operator,agro_export_coordinator,agricultural_drone_precision_farming,farm_to_market_aggregator" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "automotive_mechanical" and job_code in "auto_electrician,vehicle_mechanic_diagnostics,panel_beater_spray_painter,tyre_technician_alignment_specialist,auto_parts_salesperson" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "personal_services_beauty" and job_code in "barber_hairstylist,beautician_cosmetologist,massage_therapist,fitness_instructor_personal_trainer,house_cleaner_domestic_worker,childcare_provider_nanny" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "security_protective_services" and job_code in "security_guard_corporate_security,private_investigator,firefighter_emergency_responder,loss_prevention_officer" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "gig_economy_freelance_remote" and job_code in "freelance_developer_designer,virtual_assistant_remote_support,online_english_tutor,transcriptionist_translator,micro_task_worker" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "science_research_higher_education" and job_code in "laboratory_researcher_scientist,research_assistant,clinical_trial_coordinator,data_scientist_statistician,environmental_scientist_ecologist" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "entrepreneurship_small_business" and job_code in "kiosk_retail_owner,salon_barber_shop_owner,food_vendor_street_food_stall,courier_startup_founder,tech_startup_founder" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "creative_entrepreneurship_arts" and job_code in "fashion_designer_tailor_entrepreneur,musician_audio_producer,craft_maker_artisan,film_documentary_maker_producer" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% elif category_code == "sports_recreation_fitness" and job_code in "sports_administrator_club_manager,referee_umpire_match_official,sports_coach,sports_football,sports_athletics,sports_rugby,sports_basketball,sports_boxing_taekwondo,fitness_instructor_gym_trainer" %}
                                <div class="form-check">
                                    <input type="checkbox" name="job_occupations" value="{{ job_code }}" id="job_{{ job_code }}" class="form-check-input job-checkbox" onchange="checkJobSelectionLimit()">
                                    <label for="job_{{ job_code }}" class="form-check-label" style="color: #ffffff; font-size: 0.9em;">{{ job_label }}</label>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div style="margin-top: 20px;">
                <label style="color: #ffffff; margin-bottom: 5px; display: block;">Additional Income & Occupation Details (Optional)</label>
                <textarea name="income_details" rows="3" placeholder="Enter additional income information, occupation details, or other relevant information..."
                          style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;"></textarea>
            </div>
        </div>

        <!-- Baptismal Information Section -->
        <div style="margin-bottom: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-cross" style="margin-right: 8px;"></i>
                Baptismal Information
            </h6>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Baptismal First Name *</label>
                    <input type="text" name="baptismal_first_name" required
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Baptismal Last Name *</label>
                    <input type="text" name="baptismal_last_name" required
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Date Baptized *</label>
                    <input type="date" name="date_baptized" required
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Date Joined Religion *</label>
                    <input type="date" name="date_joined_religion" required
                           style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                </div>
            </div>
        </div>

        <!-- Home Church Structure Section -->
        <div style="margin-bottom: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #dc2626;">
                <i class="fas fa-home" style="margin-right: 8px;"></i>
                Home Church Structure *
            </h6>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Home Diocese *</label>
                    <select name="user_home_diocese" id="home-diocese-select" required
                            style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="">Select Diocese</option>
                        {% for diocese in dioceses %}
                        <option value="{{ diocese.id }}">{{ diocese.name }} ({{ diocese.country }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Home Pastorate *</label>
                    <select name="user_home_pastorate" id="home-pastorate-select" required
                            style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="">Select Pastorate</option>
                    </select>
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Home Church *</label>
                    <select name="user_home_church" id="home-church-select" required
                            style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="">Select Church</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Town Church Structure Section (Optional) -->
        <div style="margin-bottom: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #6b7280;">
                <i class="fas fa-building" style="margin-right: 8px;"></i>
                Town Church Structure (Optional - for work/education/treatment)
            </h6>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Town Diocese</label>
                    <select name="user_town_diocese" id="town-diocese-select"
                            style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="">Select Diocese</option>
                        {% for diocese in dioceses %}
                        <option value="{{ diocese.id }}">{{ diocese.name }} ({{ diocese.country }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Town Pastorate</label>
                    <select name="user_town_pastorate" id="town-pastorate-select"
                            style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="">Select Pastorate</option>
                    </select>
                </div>
                <div>
                    <label style="color: #ffffff; margin-bottom: 5px; display: block;">Town Church</label>
                    <select name="user_town_church" id="town-church-select"
                            style="width: 100%; padding: 10px; border: 1px solid #374151; background: #1f2937; color: #ffffff; border-radius: 4px;">
                        <option value="">Select Church</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Custom Fields Section -->
        <div style="margin-bottom: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #6b7280;">
                <i class="fas fa-sliders-h" style="margin-right: 8px;"></i>
                Custom Fields Configuration
            </h6>

            <div id="custom-fields-container">
                <!-- Custom fields will be added here dynamically -->
            </div>
            <button type="button" onclick="addCustomField()" class="btn btn-info" style="margin-top: 10px;">
                <i class="fas fa-plus" style="margin-right: 5px;"></i>
                Add Custom Field
            </button>
        </div>

        <!-- Document Attachments Section -->
        <div style="margin-bottom: 30px;">
            <h6 style="color: #ffffff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #6b7280;">
                <i class="fas fa-file-alt" style="margin-right: 8px;"></i>
                Document Attachments
            </h6>

            <div id="documents-container">
                <!-- Document attachments will be added here dynamically -->
            </div>
            <button type="button" onclick="addDocument()" class="btn btn-info" style="margin-top: 10px;">
                <i class="fas fa-plus" style="margin-right: 5px;"></i>
                Add Document
            </button>
        </div>

        <!-- Form Actions -->
        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #374151;">
            <button type="submit" class="btn btn-primary" style="padding: 12px 30px; margin-right: 15px;">
                <i class="fas fa-save" style="margin-right: 8px;"></i>
                Register Member
            </button>
            <a href="{% url 'members:index' %}" class="btn btn-secondary" style="padding: 12px 30px;">
                <i class="fas fa-times" style="margin-right: 8px;"></i>
                Cancel
            </a>
        </div>
    </form>
</div>

<script>
        // Toggle identifier field based on is_member selection
        function toggleIdentifierField(selectElement) {
            const row = selectElement.closest('.row') || selectElement.closest('.family-member-row');
            const identifierField = row.querySelector('.identifier-field');
            if (selectElement.value === 'yes') {
                identifierField.style.display = 'block';
            } else {
                identifierField.style.display = 'none';
                const input = identifierField.querySelector('input');
                if (input) input.value = '';
            }
        }

        // Add Father
        let fatherCount = 1;
        function addFather() {
            if (fatherCount >= 3) {
                alert('You can only add up to 3 fathers (Biological, Baptismal, Hand Ordination)');
                return;
            }
            fatherCount++;
            const container = document.getElementById('fathers-container');
            const newRow = `
                <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div class="row">
                        <div class="col-md-3">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Type</label>
                            <select name="father_type[]" class="form-control" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                <option value="biological">Biological</option>
                                <option value="baptismal">Baptismal</option>
                                <option value="hand_ordination">Hand Ordination</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                            <input type="text" name="father_name[]" class="form-control" placeholder="e.g., John Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-2">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                            <input type="tel" name="father_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-2">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                            <select name="father_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="col-md-1 identifier-field" style="display: none;">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                            <input type="text" name="father_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-1">
                            <label style="color: transparent; font-size: 0.9rem;">.</label>
                            <button type="button" onclick="this.closest('.family-member-row').remove(); fatherCount--;" class="btn btn-danger btn-sm" style="width: 100%;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newRow);
        }

        // Add Mother
        let motherCount = 1;
        function addMother() {
            if (motherCount >= 3) {
                alert('You can only add up to 3 mothers (Biological, Baptismal, Hand Ordination)');
                return;
            }
            motherCount++;
            const container = document.getElementById('mothers-container');
            const newRow = `
                <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div class="row">
                        <div class="col-md-3">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Type</label>
                            <select name="mother_type[]" class="form-control" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                <option value="biological">Biological</option>
                                <option value="baptismal">Baptismal</option>
                                <option value="hand_ordination">Hand Ordination</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                            <input type="text" name="mother_name[]" class="form-control" placeholder="e.g., Jane Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-2">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                            <input type="tel" name="mother_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-2">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                            <select name="mother_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="col-md-1 identifier-field" style="display: none;">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                            <input type="text" name="mother_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-1">
                            <label style="color: transparent; font-size: 0.9rem;">.</label>
                            <button type="button" onclick="this.closest('.family-member-row').remove(); motherCount--;" class="btn btn-danger btn-sm" style="width: 100%;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newRow);
        }

        // Add Spouse
        function addSpouse() {
            const container = document.getElementById('spouses-container');
            if (container.children.length >= 1) {
                alert('You can only add one spouse');
                return;
            }
            const newRow = `
                <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div class="row">
                        <div class="col-md-4">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                            <input type="text" name="spouse_name[]" class="form-control" placeholder="e.g., Jane Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-3">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                            <input type="tel" name="spouse_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-2">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                            <select name="spouse_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="col-md-2 identifier-field" style="display: none;">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                            <input type="text" name="spouse_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-1">
                            <label style="color: transparent; font-size: 0.9rem;">.</label>
                            <button type="button" onclick="this.closest('.family-member-row').remove();" class="btn btn-danger btn-sm" style="width: 100%;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newRow);
        }

        // Add Guardian
        function addGuardian() {
            const container = document.getElementById('guardians-container');
            const newRow = `
                <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div class="row">
                        <div class="col-md-4">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                            <input type="text" name="guardian_name[]" class="form-control" placeholder="e.g., John Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-3">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                            <input type="tel" name="guardian_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-2">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                            <select name="guardian_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="col-md-2 identifier-field" style="display: none;">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                            <input type="text" name="guardian_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-1">
                            <label style="color: transparent; font-size: 0.9rem;">.</label>
                            <button type="button" onclick="this.closest('.family-member-row').remove();" class="btn btn-danger btn-sm" style="width: 100%;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newRow);
        }

        // Add Brother
        function addBrother() {
            const container = document.getElementById('brothers-container');
            const newRow = `
                <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div class="row">
                        <div class="col-md-4">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                            <input type="text" name="brother_name[]" class="form-control" placeholder="e.g., John Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-3">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                            <input type="tel" name="brother_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-2">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                            <select name="brother_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="col-md-2 identifier-field" style="display: none;">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                            <input type="text" name="brother_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-1">
                            <label style="color: transparent; font-size: 0.9rem;">.</label>
                            <button type="button" onclick="this.closest('.family-member-row').remove();" class="btn btn-danger btn-sm" style="width: 100%;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newRow);
        }

        // Add Sister
        function addSister() {
            const container = document.getElementById('sisters-container');
            const newRow = `
                <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div class="row">
                        <div class="col-md-4">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                            <input type="text" name="sister_name[]" class="form-control" placeholder="e.g., Jane Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-3">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                            <input type="tel" name="sister_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-2">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                            <select name="sister_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="col-md-2 identifier-field" style="display: none;">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                            <input type="text" name="sister_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-1">
                            <label style="color: transparent; font-size: 0.9rem;">.</label>
                            <button type="button" onclick="this.closest('.family-member-row').remove();" class="btn btn-danger btn-sm" style="width: 100%;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newRow);
        }

        // Add Uncle
        function addUncle() {
            const container = document.getElementById('uncles-container');
            const newRow = `
                <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div class="row">
                        <div class="col-md-4">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                            <input type="text" name="uncle_name[]" class="form-control" placeholder="e.g., John Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-3">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                            <input type="tel" name="uncle_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-2">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                            <select name="uncle_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="col-md-2 identifier-field" style="display: none;">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                            <input type="text" name="uncle_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-1">
                            <label style="color: transparent; font-size: 0.9rem;">.</label>
                            <button type="button" onclick="this.closest('.family-member-row').remove();" class="btn btn-danger btn-sm" style="width: 100%;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newRow);
        }

        // Add Aunt
        function addAunt() {
            const container = document.getElementById('aunts-container');
            const newRow = `
                <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div class="row">
                        <div class="col-md-4">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                            <input type="text" name="aunt_name[]" class="form-control" placeholder="e.g., Jane Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-3">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                            <input type="tel" name="aunt_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-2">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                            <select name="aunt_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="col-md-2 identifier-field" style="display: none;">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                            <input type="text" name="aunt_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-1">
                            <label style="color: transparent; font-size: 0.9rem;">.</label>
                            <button type="button" onclick="this.closest('.family-member-row').remove();" class="btn btn-danger btn-sm" style="width: 100%;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newRow);
        }

        // Add Friend
        function addFriend() {
            const container = document.getElementById('friends-container');
            const newRow = `
                <div class="family-member-row" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                    <div class="row">
                        <div class="col-md-4">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Full Name</label>
                            <input type="text" name="friend_name[]" class="form-control" placeholder="e.g., John Doe" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-3">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Phone</label>
                            <input type="tel" name="friend_phone[]" class="form-control" placeholder="+254..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-2">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Is Member?</label>
                            <select name="friend_is_member[]" class="form-control is-member-select" onchange="toggleIdentifierField(this)" style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="col-md-2 identifier-field" style="display: none;">
                            <label style="color: #9ca3af; font-size: 0.9rem;">Identifier</label>
                            <input type="text" name="friend_identifier[]" class="form-control" placeholder="RUWE-..." style="background: #1f2937; color: #ffffff; border: 1px solid #374151;">
                        </div>
                        <div class="col-md-1">
                            <label style="color: transparent; font-size: 0.9rem;">.</label>
                            <button type="button" onclick="this.closest('.family-member-row').remove();" class="btn btn-danger btn-sm" style="width: 100%;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newRow);
        }
    </script>
{% endblock %}